{% extends 'common/index.html'%}
{% include staticfiles%}
{% block content %}

	<div class="row">
		<a href="{% url 'samraemd:result_create'%}" class="btn btn-default">
			<span class="glyphicon glyphicon-plus"></span>&nbsp;Bæta við niðurstöðum
		</a>
	</div>
{% for job in jobs %}
	<div class="row" id="result-row-{{ job }}" style="display: none;">
		<div class="col-md-4">
			<p>Innlestur gagna í gangi <span id="result-text-{{ job }}"></span>:</p>
		</div>
		<div class="col-md-8">
			<div id="job-progressouter-{{ job }}" class="progress">
				<div id="job-progress-{{ job }}" class="progress-bar progress-bar-striped active" role="progressbar"
				aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
				0%
				</div>
			</div>
		</div>
	</div>
{% endfor %}
	<div class="row">
		<h2>Samræmd próf í stærðfræði</h2>
		<table class="table table-hover table-striped">
			<thead>
				<tr>
					<th class="col-md-10">Kóði</th>
					<th class="col-md-2">Aðgerðir</th>
				</tr>
			</thead>
			<tbody>
				{% for exam in math_exams %}
				<tr>
					<td>
						<a href="{% url 'samraemd:math_admin_result_detail' exam.exam_date|date:'Y' exam.student_year %}">
							{{ exam.exam_code }}
						</a>
					</td>
					<td>
						<a href="{% url 'samraemd:math_delete' exam.exam_code %}">
							<span class="glyphicon glyphicon-trash"></span>
						</a>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>

	<div class="row">
		<h2>Samræmd próf í íslensku</h2>
		<table class="table table-hover table-striped">
			<thead>
				<tr>
					<th class="col-md-10">Kóði</th>
					<th class="col-md-2">Aðgerðir</th>
				</tr>
			</thead>
			<tbody>
				{% for exam in isl_exams %}
				<tr>
					<td>
						<a href="{% url 'samraemd:isl_admin_result_detail' exam.exam_date|date:'Y' exam.student_year %}">
							{{ exam.exam_code }}
						</a>
					</td>
					<td>
						<a href="{% url 'samraemd:isl_delete' exam.exam_code %}">
							<span class="glyphicon glyphicon-trash"></span>
						</a>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>

	<div class="row">
		<h2>Samræmd próf í ensku</h2>
		<table class="table table-hover table-striped">
			<thead>
				<tr>
					<th class="col-md-10">Kóði</th>
					<th class="col-md-2">Aðgerðir</th>
				</tr>
			</thead>
			<tbody>
				{% for exam in ens_exams %}
				<tr>
					<td>
						<a href="{% url 'samraemd:ens_admin_result_detail' exam.exam_date|date:'Y' exam.student_year %}">
							{{ exam.exam_code }}
						</a>
					</td>
					<td>
						<a href="{% url 'samraemd:ens_delete' exam.exam_code %}">
							<span class="glyphicon glyphicon-trash"></span>
						</a>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
	<!--
	<h3>Hrágögn</h3>
	<div class="row">
		<a href="{% url 'samraemd:rawdatacreate'%}" class="btn btn-default">
			<span class="glyphicon glyphicon-plus"></span>&nbsp;Bæta við niðurstöðum
		</a>
	</div>
	<div>
		<div class="row">
			<div class="col-md-4"><h4>Próf</h4></div>
			<div class="col-md-2"><h4>Aðgerðir</h4></div>
		</div>
		{% for exam in raw_exams %}
		<div class="row">
			<div class="col-md-4"><a href="{% url 'samraemd:admin_result_detail' exam.exam_code exam.exam_date|date:'Y' exam.student_year %}">{{exam.exam_name}}</a></div>
			<div class="col-md-2"><a href="{% url 'samraemd:raw_delete' exam.exam_code exam.exam_date|date:'Y' exam.student_year %}"><span class="glyphicon glyphicon-trash"></span></a></div>
		</div>
		{% endfor %}
	</div>-->
{% endblock %}

{% block script %}

<script type="text/javascript">
$(document).ready(function(){
	{% for job in jobs %}
	var progresspump{{ forloop.counter }} = setInterval(function(){
		/* query the completion percentage from the server */
		$.get("{% url 'schools:api_task_monitor' %}?job={{ job }}", function(data){
			if (data == 'SUCCESS') {
				clearInterval(progresspump{{ forloop.counter }});
				$("#result-text-{{ job }}").html("");
				$("#job-progress-{{ job }}").removeClass("active");
				$("#job-progress-{{ job }}").html("Done");
				$("#job-progress-{{ job }}").css('width', '100%');
			} else if (data == 'FAILURE') {
				clearInterval(progresspump{{ forloop.counter }});
				$("#result_row-{{ job }}").html("<p>Innlestur gagna mistókst!</p>");
			} else {
				$("#result-text-{{ job }}").html("(" + data.current + " af " + data.total + ")");
				pct = ((data.current / data.total) * 100).toFixed(1)
				/* update the progress bar width */
	      		$("#job-progress-{{ job }}").css('width',pct+'%');
	      		/* and display the numeric value */
	      		$("#job-progress-{{ job }}").html(pct+'%');

	      		/* test to see if the job has completed */
	      		if(pct > 99.9) {
	        		clearInterval(progresspump);
	        		$("#result-text-{{ job }}").html("");
	        		$("#job-progress-{{ job }}").removeClass("active");
	        		$("#job-progress-{{ job }}").html("Done");
	      		}
      		}
      		$("#result-row-{{ job }}").show();
    	})
	}, 3000);
	{% endfor %}
});
</script>

{% endblock %}