{% extends 'common/index.html'%}

{% block content %}
<h3>Prófadæma svör</h3>
<div class="row">
	<a href="{% url 'schools:example_survey_answer_admin_import' %}" class="btn btn-default">
		<span class="glyphicon glyphicon-plus"></span>&nbsp;Bæta við svörum
	</a>
</div>
{% if job %}
<div class="row" id="result_row" style="display: none;">
	<div class="col-md-4">
		<p>Innlestur gagna í gangi <span id="result-text"></span>:</p>
	</div>
	<div class="col-md-8">
		<div id="job-progressouter" class="progress">
			<div id="job-progress" class="progress-bar progress-bar-striped active" role="progressbar"
			aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width:0%">
			0%
			</div>
		</div>
	</div>
</div>
{% endif %}
<div>
	<table class="table table-hover table-striped" id="example_survey_answer_list">
		<thead>
			<tr>
				<th>Kennitala</th>
				<th>Flýtikóði</th>
				<th>Próf</th>
				<th>Dags</th>
				<th>Svar</th>
				<th>Aðgerðir</th>
			</tr>
		</thead>
		<tbody>
			{% for answer in answers %}
			<tr>
				<td>{{answer.student.ssn}}</td>
				<td>{{answer.question.quickcode}}</td>
				<td>
				{% if answer.groupsurvey %}
					{{answer.groupsurvey.survey.identifier}}
				{% else %}
					{{ answer.exam_code }}
				{% endif %}
				</td>
				<td>{{answer.date}}</td>
				<td>
				{% if answer.answer %}
					<span class="glyphicon glyphicon-ok" style="color:green"></span>&nbsp;
				{% else %}
					<span class="glyphicon glyphicon-remove" style="color:red"></span>&nbsp;
				{% endif %}
				</td>
				<td>
					<a href="{% url 'schools:example_survey_answer_admin_detail' answer.id %}">
						<span class="glyphicon glyphicon-eye-open"></span>
					</a>
					<a href="{% url 'schools:example_survey_answer_admin_delete' answer.id %}">
						<span class="glyphicon glyphicon-trash"></span>
					</a>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>
	<div class="pagination">
    <span class="step-links">
        {% if answers.has_previous %}
            <a href="?page={{ answers.previous_page_number }}"><span class="glyphicon glyphicon-chevron-left"></span>&nbsp;previous</a>
        {% endif %}

        <span class="current">
            Page {{ answers.number }} of {{ answers.paginator.num_pages }}.
        </span>

        {% if answers.has_next %}
            <a href="?page={{ answers.next_page_number }}">next&nbsp;<span class="glyphicon glyphicon-chevron-right"></span></a>
        {% endif %}
    </span>
</div>
</div>
{% endblock %}

{% block script %}

{% if job %}
<script type="text/javascript">
$(document).ready(function(){
	var progresspump = setInterval(function(){
		/* query the completion percentage from the server */
		$.get("{% url 'schools:api_task_monitor' %}?job={{ job }}", function(data){
			if (data == 'SUCCESS') {
				clearInterval(progresspump);
				$("#result-text").html("");
				$("#job-progress").removeClass("active");
				$("#job-progress").html("Done");
				$("#job-progress").css('width', '100%');
			} else if (data == 'FAILURE') {
				clearInterval(progresspump);
				$('#result_row').html("<p>Innlestur gagna mistókst!</p>");
			} else {
				$("#result-text").html("(" + data.current + " af " + data.total + ")");
				pct = ((data.current / data.total) * 100).toFixed(1)
				/* update the progress bar width */
	      		$("#job-progress").css('width',pct+'%');
	      		/* and display the numeric value */
	      		$("#job-progress").html(pct+'%');

	      		/* test to see if the job has completed */
	      		if(pct > 99.9) {
	        		clearInterval(progresspump);
	        		$("#job-progress").removeClass("active");
	        		$("#job-progress").html("Done");
	      		}
      		}
      		$("#result_row").show();
    	})
	}, 3000);
});
</script>
{% endif %}
{% endblock %}